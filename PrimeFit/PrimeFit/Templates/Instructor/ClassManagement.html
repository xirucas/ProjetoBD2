{% extends 'base/base.html' %}

{% block title %}Gerenciamento de Aulas{% endblock %}

{% block content %}
<div class="d-flex justify-content-between align-items-center mb-4">
    <h1>Minhas Aulas</h1>
</div>

<!-- Estatísticas das Aulas -->
<div class="row mb-4">
    <div class="col-md-3">
        <div class="card bg-primary text-white">
            <div class="card-body">
                <h5>Aulas Hoje</h5>
                <h2>{{ dashboard_stats.classes_today }}</h2>
            </div>
        </div>
    </div>
    <div class="col-md-3">
        <div class="card bg-success text-white">
            <div class="card-body">
                <h5>Alunos Confirmados</h5>
                <h2>{{ dashboard_stats.students_today }}</h2>
                <small>Para hoje</small>
            </div>
        </div>
    </div>
    <div class="col-md-3">
        <div class="card bg-warning text-white">
            <div class="card-body">
                <h5>Taxa de Ocupação</h5>
                <h2>{{ dashboard_stats.occupation_rate }}%</h2>
                <small>Média mensal</small>
            </div>
        </div>
    </div>
    <div class="col-md-3">
        <div class="card bg-info text-white">
            <div class="card-body">
                <h5>Próxima Aula</h5>
                {% if dashboard_stats.next_class_time %}
                    <h2>{{ dashboard_stats.next_class_time }}</h2>
                    <small>{{ dashboard_stats.next_class_name }} - {{ dashboard_stats.next_class_room }}</small>
                {% else %}
                    <h2>--</h2>
                    <small>Nenhuma aula agendada</small>
                {% endif %}
            </div>
        </div>
    </div>
</div>

<!-- Aulas de Hoje -->
<div class="card mb-4">
    <div class="card-header">
        <h5>Minhas Aulas - Hoje ({{ today_date | date:"d/m/Y" }})</h5>
    </div>
    <div class="card-body">
        <div class="row">
            {% if class_today %}
            {% for class in class_today %}
            <div class="col-md-4">
                <div class="card border-warning">
                    <div class="card-header bg-warning text-white">
                        <h6>{{ class.time_slot }}</h6>
                    </div>
                    <div class="card-body">
                        <h5>{{ class.class_name }}</h5>
                        <p><strong>Sala:</strong> {{ class.room }}</p>
                        <p><strong>Inscritos:</strong> {{ class.enrolled }}/{{ class.capacity }}</p>
                    </div>
                </div>
            </div>
            {% endfor %}
            {% else %}
            <div class="col-md-4">
                <td colspan="7" class="text-center text-muted">Nenhuma aula agendada para hoje</td>
            </div>
            {% endif %}
        </div>
    </div>
</div>

<!-- Lista de Alunos Inscritos -->
<div class="card mb-4">
    <div class="card-header d-flex justify-content-between align-items-center">
        <h5>{% if next_class %} Próxima Aula: {{ next_class.name }} ({{ next_class.time }}) {%else%} Nenhuma Aula Agendada {% endif %}</h5>
        <span class="badge bg-info">{{ next_class_members|length }} inscritos</span>
    </div>
    <div class="card-body">
        <div class="table-responsive">
            {% if next_class_members %}
            <table class="table">
                <thead>
                    <tr>
                        <th>Nome</th>
                        <th>ID Membro</th>
                        <th>Plano</th>
                    </tr>
                </thead>
                <tbody>
                    
                    {% for member in next_class_members %}
                    <tr>
                        <td>{{ member.name }}</td>
                        <td>{{ member.member_id }}</td>
                        <td><span class="badge bg-primary">{{ member.plan }}</span></td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
            {% else %}
            <div class="col-md-4">
                <td colspan="7" class="text-center text-muted">Nenhum aluno inscrito</td>
            </div>
            {% endif %}
        </div>
    </div>
</div>

<!-- Histórico de Aulas -->
<div class="card">
    <div class="card-header">
        <h5>Histórico de Aulas - Última Semana</h5>
    </div>
    <div class="card-body">
        <div class="table-responsive">
            {% if class_history %}
            <table class="table table-striped">
                <thead>
                    <tr>
                        <th>Data</th>
                        <th>Horário</th>
                        <th>Aula</th>
                        <th>Sala</th>
                        <th>Inscritos</th>
                        <th>Presentes</th>
                        <th>Taxa</th>
                        <th>Status</th>
                        <th>Ações</th>
                    </tr>
                </thead>
                <tbody>
                    {% for class in class_history %}
                    <tr>
                        <td>{{ class.date }}</td>
                        <td>{{ class.schedule }}</td>
                        <td>{{ class.class_name }}</td>
                        <td>{{ class.room }}</td>
                        <td>{{ class.enrolled_students }}</td>
                        <td>{{ class.present_students }}</td>
                        <td>{{ class.attendance_rate }}</td>
                        <td>
                            <button class="btn btn-sm btn-outline-primary">Ver</button>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
            {% else %}
            <div class="col-md-4">
                <td colspan="7" class="text-center text-muted">Nenhuma aula registrada</td>
            </div>
            {% endif %}
        </div>
        
        <!-- Resumo da Performance -->
        <div class="row mt-4">
            <div class="col-md-6">
                <div class="card bg-light">
                    <div class="card-body">
                        <h6>Performance da Semana</h6>
                        <p><strong>Total de Aulas:</strong> {{ weekly_performance.total_classes }}</p>
                        <p><strong>Total de Alunos:</strong> {{ weekly_performance.total_students }}</p>
                        <p><strong>Taxa Média de Presença:</strong> {{ weekly_performance.average_attendance }}%</p>
                        <p><strong>Avaliação Média:</strong> TBD/5.0</p>
                    </div>
                </div>
            </div>
            <div class="col-md-6">
                <div class="card bg-light">
                    <div class="card-body">
                        <h6>Aulas Mais Populares</h6>
                        {% for class in popular_classes %}
                        <p><strong>{{ forloop.counter }}º {{ class.class_name }}:</strong> {{ class.occupation_rate }}% ocupação</p>
                        {% endfor %}
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}
